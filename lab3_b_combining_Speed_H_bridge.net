* E:\EDL\LAB3\lab3_b_combining_Speed_H_bridge.asc
RB 0 b1 680
RB2 o2 b2 680
C8 o2 0 47µ
VDC o2 0 10
XX1 b1 b2 o2 0 N001 N002 h_bridge1
XX2 N001 N002 ENC w dc_motor_model
R1 VCC trig 1k
D1 trig VCC 1N4148
C1 ENC trig 4.7n
XU1 0 trig 555_out VCC N004 N003 N003 VCC NE555
R2 VCC N003 6.3k
C2 N003 0 .1µ
C4 N004 0 0.1µF
VCC VCC 0 5
C5 VCC 0 0.1µ
C6 VCC 0 .1µ
C7 VCC 0 47µ
R3 pwm_buffered Speed 5.6k
C3 Speed 0 10n
R4 0 N005 33k
R5 N005 VCC 33k
XU2 555_out N005 VCC 0 pwm_buffered level.2 Avol=1Meg GBW=2Meg Slew=10Meg ilimit=20m rail=0.2 Vos=0 phimargin=45 en=0 enk=0 in=0 ink=0 Rin=500Meg

* block symbol definitions
.subckt h_bridge1 B1 B2 DCSupply DCgnd DC2 DC1
Q1 DCgnd B1 DC1 0 2N2905A
Q2 DCgnd B2 DC2 0 2N2905A
Q3 DCSupply B1 DC1 0 FZT849
Q4 DCSupply B2 DC2 0 FZT849
C1 DCSupply DCgnd 47µ
.ends h_bridge1

.subckt dc_motor_model +DC -DC enc omega
Aenc N002 0 0 0 0 p 0 0 SCHMITT Vt=0.5 Vh=0.5 td=10n
Bp 0 N002 I=kenc*abs(v(omega))*(V(p)-0.5)
Cenc N002 0 1m
LM +DC N001 65µH
RM N001 emf {RM}
Bemf emf -DC V=k*V(omega)
B§Itorque 0 omega I=k*I(Bemf)
C_Jinertia omega 0 {J}
R_Bfriction omega 0 {1/B}
Benc N003 0 V=5*V(p)
B§I_load_torque_int omega 0 I=sgn(v(omega))*min(Tint,0.1*abs(v(omega)))
R1 enc N003 220
.param kenc=0.49
.param RM=2.02
.param k = 0.9
.param J = 1.03m
.param B = 5.94m
.param Tint = 0.0407
.ends dc_motor_model

.model D D
.lib C:\Users\kwat1\Documents\LTspiceXVII\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Users\kwat1\Documents\LTspiceXVII\lib\cmp\standard.bjt
.tran 0 0.05 0 startup
.lib NE555.sub
.lib UniversalOpamps2.sub
.backanno
.end
